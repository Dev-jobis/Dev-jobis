<source>
  @type kafka
  brokers kafka1:9092,kafka2:9092,kafka3:9092
  topics chatbot-log # 챗봇 로그 토픽
  format json
</source>
<source>
  @type kafka
  brokers kafka1:9092,kafka2:9092,kafka3:9092
  topics embedding-log # 임베딩 로그 토픽
  format json
</source>
<match embedding-log>
  @type opensearch # 오픈서치로 로그 전송
  hosts "#{ENV['OPEN_URL']}"
  port 443
  user "#{ENV['OPENSEARCH_USER']}"
  password "#{ENV['OPENSEARCH_PASS']}"
  index_name embedding-log
  logstash_format false
</match>
<match chatbot-log>
  @type opensearch
  hosts "#{ENV['OPEN_URL']}"
  port 443
  user "#{ENV['OPENSEARCH_USER']}"
  password "#{ENV['OPENSEARCH_PASS']}"
  index_name chatbot-log
  logstash_format false
</match>

# 카프카 2서버 fluentd.conf
<source>
  @type kafka
  brokers kafka1:9092,kafka2:9092,kafka3:9092
  topics crawler-job-data # 크롤링 잡 데이터 토픽
  format none
</source>
<match crawler-job-data>
  @type s3 # s3로 크롤링 잡 데이터 전송
  s3_bucket project05-crawling
  region ap-northeast-2
  path job-data/
  store_as text
  <buffer>
   timekey 300
  timekey_wait 10
  </buffer>
  <format>
    @type single_value # 크롤링 잡 데이터는 단일 값
  </format>
</match>
<source>
  @type kafka
  brokers kafka1:9092,kafka2:9092,kafka3:9092
  topics crawler-log
  format json
</source>
<match crawler-log>
  @type opensearch
  hosts "#{ENV['OPEN_URL']}"
  port 443
  user "#{ENV['OPENSEARCH_USER']}"
  password "#{ENV['OPENSEARCH_PASS']}"
  index_name crawling-log
  logstash_format false
</match>